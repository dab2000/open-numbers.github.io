{"version":3,"sources":["webpack:///barchart-ds.js","webpack:///webpack/bootstrap e870d5d419cbde515963","webpack:///./src/index.js","webpack:///./src/component.js","webpack:///./src/template.html"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","i","l","call","m","c","value","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","_component","_component2","obj","default","VERSION_INFO","version","build","BarChartDS","Vizabi","Tool","extend","init","placeholder","external_model","this","components","component","model","Component","_super","validate","entities","state","keys","show","length","dim","entities_geodomain","skipFilter","entities_side","entities_allpossible","default_model","marker_tags","ui","chart","stacked","inpercent","flipSides","buttons","dialogs","popup","sidebar","moreoptions","presentation","locale","versionInfo","_toConsumableArray","arr","Array","isArray","arr2","from","_Vizabi","utils","axisSmart","helpers","iconQuestion","iconset","question","config","context","template","model_expects","type","_this","model_binds","change:time.value","evt","_readyOnce","time","step","snapped","playing","dragging","next","d3","bisectLeft","timeSteps","prev","snapTime","Date","marker","getFrame","frame","frameAxisX","axis_x","marker_order","frameOrder","hook_order","_reorderBars","_updateEntities","updateBarsOpacity","change:marker","path","indexOf","ready","change:marker.select","someSelected","select","nonSelectedOpacityZero","change:marker.highlight","_highlightBars","change:marker.opacitySelectDim","change:marker.opacityRegular","change:marker.color.palette","change:marker.color.scaleType","change:marker.color.which","stackDim","color","use","colorConcept","getConceptprops","concept_type","domain","which","sideConcept","side","setWhich","concept","geoDomainDimension","SIDEDIM","set","change:marker.side.which","sideDim","STACKDIM","clearSideState","clearShow","change:entities.show","isEmpty","forEach","getFilteredEntities","isShown","showEntity","change:entities_side.show","doReturn","_entitiesSameDimWithSide","_space","h","_name","_updateIndicators","_updateLimits","resize","change:ui.chart.inpercent","change:ui.chart.flipSides","switchSideState","xScale","yScale","cScale","xAxis","xAxisLeft","yAxis","xScales","totalFieldName","checkDimensions","colorUseNotProperty","stackSkip","geoLess","AGEDIM","sideSkip","readyOnce","el","element","interaction","_interaction","graph","yAxisEl","xAxisEl","xAxisLeftEl","xTitleEl","xInfoEl","yTitleEl","barsCrop","labelsCrop","bars","labels","attr","title","titleRight","year","getDimension","geoDomainDefaultValue","on","_attributeUpdaters","_newWidth","width","PREFIXEDSIDEDIM","PREFIXEDSTACKDIM","total","width_","_newX","prevSbl","previousSibling","prevSblDatum","datum","x_","_this2","_ready","getAllSteps","shiftScale","scaleLinear","range","KEYS","unique","_getAllDimensions","exceptType","label_side","getEntity","stack","label_stack","age","axis_y","SHIFTEDAGEDIM","TIMEDIM","groupBy","grouping","updateUIStrings","_createLimits","markers","getKeys","translator","getTFunction","xTitle","selectAll","data","enter","append","parent","findChildByName","markerID","alignX","isRTL","alignY","updateView","toggle","conceptPropsX","setIcon","style","Number","Boolean","description","sourceLink","pin","rect","getBBox","coord","makeAbsoluteContext","farthestViewportElement","x","y","height","toolRect","root","getBoundingClientRect","chartRect","node","setHook","setPos","left","hide","_this3","duration","delayAnimations","getScale","tickFormat","getTickFormatter","ageDim","ages","ageKeys","map","shiftedAgeKeys","sideItems","getItems","sideKeys","sideFiltered","filter","f","sortFunc","ascending","descending","sort","push","stacks","stackKeys","without","dataWithTotal","sortedStackKeys","getPalette","reduce","val","stackItems","twoSided","classed","xScaleLeft","copy","text","a","b","result","axisX","sideKeysNF","getNestedItems","limits","getLimitsByDimensions","concat","timeKeys","getUnique","totals","inpercentMaxLimits","maxLimits","ageSum","sideMaxLimits","stackSum","max","maxSideLimit","Math","apply","zero","scaleType","domainMin","domainMax","_interpolateBetweenTotals","nextStep","fraction","reorder","prefixedSideDim","prefixedStackDim","shiftedAgeDim","ageBars","slice","entityBars","exit","remove","barHeight","oneBarHeight","firstBarOffsetY","merge","sideBars","r","activeProfile","centerWidth","stackBars","highlighted","mouseover","mouseout","click","onTap","tap","order","transition","ease","easeLinear","interrupt","_setYear","formatDate","timeValue","formattedTime","isTouchDevice","highlightMarker","clearHighlighted","selectMarker","event","stopPropagation","someHighlighted","highlight","_showLabel","formatter","format","label","bar","textData","label_age","getValueMD","presentationProfileChanges","medium","margin","right","bottom","infoElHeight","large","top","profiles","small","titlesSpacing","getActiveProfile","parseInt","warn","maxRange","scale","tickValues","tickSizeInner","tickSizeOuter","tickPadding","tickSizeMinor","labelerOptions","toolMargin","limitMaxTickNumber","translateX","rangePoints","zeroTickEl","empty","zeroTickWidth","tickNodes","nodes","titleBBox","t","transform","hTranslate","translateY","OPACITY_HIGHLT_DIM","opacityHighlightDim","OPACITY_SELECT","opacityRegular","OPACITY_REGULAR","OPACITY_SELECT_DIM","opacitySelectDim","isHighlighted","isSelected"],"mappings":"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","file":"barchart-ds.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId]) {\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/ \t\t}\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 4);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\n__webpack_require__(2);\n\nvar _component = __webpack_require__(1);\n\nvar _component2 = _interopRequireDefault(_component);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nvar VERSION_INFO = { version: \"1.0.8\", build: 1503526275229 };\n\n//BAR CHART TOOL\nvar BarChartDS = Vizabi.Tool.extend(\"BarChartDS\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init: function init(placeholder, external_model) {\n\n    this.name = \"barchartds\";\n\n    //specifying components\n    this.components = [{\n      component: _component2.default,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_order\", \"state.entities\", \"state.entities_side\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n  validate: function validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      var entities = model.state.entities;\n      if (Object.keys(entities.show).length > 0) {\n        var show = {};\n        if (entities.show[entities.dim] && Object.keys(entities.show).length !== 1) {\n          show[entities.dim] = entities.show[entities.dim];\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      var entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = model.state.entities.dim === entities_geodomain.dim || model.state.entities_side.dim === entities_geodomain.dim || model.state.entities_allpossible.dim === entities_geodomain.dim;\n    }\n  },\n\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        stacked: true,\n        inpercent: false,\n        flipSides: true\n      },\n      \"buttons\": [\"colors\", \"inpercent\", \"find\", \"side\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"find\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"find\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: {}\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexports.default = BarChartDS;\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\nvar _Vizabi = Vizabi,\n    utils = _Vizabi.utils,\n    Component = _Vizabi.Component,\n    axisSmart = _Vizabi.helpers[\"d3.axisWithLabelPicker\"],\n    iconQuestion = _Vizabi.iconset.question;\n\n// POP BY AGE CHART COMPONENT\n\nvar BarChartDS = Component.extend(\"barchartds\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init: function init(config, context) {\n    this.name = \"barchartds\";\n    this.template = __webpack_require__(3);\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"model\"\n    }, {\n      name: \"marker_order\",\n      type: \"model\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    var _this = this;\n    this.model_binds = {\n      \"change:time.value\": function changeTimeValue(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          var next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && _this.timeSteps[next] - _this.model.time.value) {\n            _this.snapped = true;\n            var time = _this.model.time.value;\n            var prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            var snapTime = time - prev < next - time ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n          //          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n          _this.model.marker.getFrame(_this.model.time.value, function (frame) {\n            _this.frame = frame;\n            _this.frameAxisX = frame.axis_x;\n            _this.model.marker_order.getFrame(_this.model.time.value, function (frameOrder) {\n              _this.frameOrder = frameOrder.hook_order;\n\n              _this._reorderBars();\n              _this._updateEntities(true);\n              _this.updateBarsOpacity();\n            });\n          });\n          // } else {\n          //   const nextIndex = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          //   const prevFrameTime = _this.timeSteps[nextIndex - 1];\n          //   const nextFrameTime = _this.timeSteps[nextIndex];\n          //   const fraction = (_this.model.time.value - prevFrameTime) / (nextFrameTime - prevFrameTime);\n          //   _this.model.marker.getFrame(nextFrameTime, nValues => {\n          //     _this.model.marker.getFrame(prevFrameTime, pValues => {\n          //       _this.frameAxisX = _this.interpolateDiagonal(pValues.axis_x, nValues.axis_x, fraction);\n          //       _this._updateEntities();\n          //       _this.updateBarsOpacity();\n          //     });\n          //   });\n          // }\n        }\n        _this.snapped = false;\n      },\n      \"change:marker\": function changeMarker(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n      },\n      \"change:marker.select\": function changeMarkerSelect(evt) {\n        _this.someSelected = _this.model.marker.select.length > 0;\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function changeMarkerHighlight(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function changeMarkerOpacitySelectDim() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function changeMarkerOpacityRegular() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function changeMarkerColorPalette(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.scaleType\": function changeMarkerColorScaleType(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function changeMarkerColorWhich(evt) {\n        if (!_this._readyOnce) return;\n        var stackDim = void 0;\n        var show = {};\n        if (_this.model.marker.color.use == \"constant\") {\n          stackDim = null;\n        } else {\n          var colorConcept = _this.model.marker.color.getConceptprops();\n          if (colorConcept.concept_type == \"entity_set\") {\n            stackDim = colorConcept.domain;\n            show[\"is--\" + _this.model.marker.color.which] = true;\n            var sideConcept = _this.model.marker.side.getConceptprops();\n            if (sideConcept.concept_type == \"entity_set\" && stackDim == sideConcept.domain && _this.model.marker.side.which !== _this.model.marker.color.which) {\n              _this.model.marker.side.setWhich({ \"concept\": _this.model.marker.color.which });\n            }\n          } else {\n            stackDim = _this.model.marker.color.which;\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = stackDim === _this.geoDomainDimension || _this.SIDEDIM === _this.geoDomainDimension;\n        _this.model.entities.set(\"show\", show);\n        _this.model.entities.set(\"dim\", stackDim);\n        _this.model.entities_allpossible.set(\"dim\", _this.model.marker.color.which);\n      },\n      \"change:marker.side.which\": function changeMarkerSideWhich(evt) {\n        if (!_this._readyOnce) return;\n        var sideDim = void 0;\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          var sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n            var colorConcept = _this.model.marker.color.getConceptprops();\n            if (colorConcept.concept_type == \"entity_set\" && sideDim == colorConcept.domain && _this.model.marker.color.which !== _this.model.marker.side.which) {\n              _this.model.marker.color.setWhich({ \"concept\": _this.model.marker.side.which });\n            }\n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        }\n        //        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.entities_geodomain.skipFilter = sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension;\n        _this.model.marker.side.clearSideState();\n        _this.model.entities_side.clearShow();\n        _this.model.entities_side.set(\"dim\", sideDim);\n      },\n      \"change:entities.show\": function changeEntitiesShow(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim && !utils.isEmpty(_this.model.entities.show) && _this.model.entities.show[_this.model.entities.dim] && !utils.isEmpty(_this.model.entities_side.show)) {\n          utils.forEach(_this.model.entities_side.getFilteredEntities(), function (s) {\n            if (!_this.model.entities.isShown(s)) {\n              _this.model.marker.side.clearSideState();\n              _this.model.entities_side.showEntity(s);\n            }\n          });\n        }\n      },\n      \"change:entities_side.show\": function changeEntities_sideShow(evt) {\n        if (!_this._readyOnce) return;\n\n        var doReturn = false;\n        var _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, function (h) {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide && !utils.isEmpty(_entitiesSameDimWithSide.show) && _entitiesSameDimWithSide.show[_entitiesSameDimWithSide.dim]) {\n          utils.forEach(_this.model.entities_side.getFilteredEntities(), function (s) {\n            if (!_entitiesSameDimWithSide.isShown(s)) {\n              _entitiesSameDimWithSide.showEntity(s);\n              doReturn = true;\n            }\n          });\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        if (!_this.model.ready || !_this.frame) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.inpercent\": function changeUiChartInpercent(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.flipSides\": function changeUiChartFlipSides(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this.resize();\n        _this._updateEntities();\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n    //this.SHIFTEDAGEDIM = \"s_age\";\n\n    this.totalFieldName = \"Total\";\n  },\n\n\n  // afterPreload: function() {\n  //   var obj = {};\n  //   obj[\"which\"] = this.model.marker.axis_x.which;\n  //   obj[\"use\"] = this.model.marker.axis_x.use;\n  //   this.model.marker_side.hook_total.set(obj);\n  // },\n\n  checkDimensions: function checkDimensions() {\n    var stackDim = this.model.entities.dim;\n    var sideDim = this.model.entities_side.dim;\n\n    this.colorUseNotProperty = this.model.marker.color.use == \"constant\" || this.model.marker.color.use == \"indicator\";\n    this.stackSkip = this.colorUseNotProperty || stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension && this.AGEDIM !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n\n  /**\n   * DOM is ready\n   */\n  readyOnce: function readyOnce() {\n    var _this = this;\n    this.el = this.el ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.interaction = this._interaction();\n\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.graph.select(\".vzb-bc-bars\");\n    this.labels = this.graph.select(\".vzb-bc-labels\");\n    this.labels.select(\".vzb-bc-age\").attr(\"y\", -10);\n\n    this.title = this.element.select(\".vzb-bc-title\");\n    this.titleRight = this.element.select(\".vzb-bc-title-right\");\n    this.year = this.element.select(\".vzb-bc-year\");\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = this.model.entities_geodomain.show[this.geoDomainDimension][\"$in\"][0];\n\n    _this.someSelected = _this.model.marker.select.length > 0;\n    _this.nonSelectedOpacityZero = false;\n\n    this.on(\"resize\", function () {\n      _this._updateEntities();\n    });\n\n    this._attributeUpdaters = {\n      _newWidth: function _newWidth(d, i) {\n        d[\"x_\"] = 0;\n        var width = void 0;\n        if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.geoLess && _this.stackSkip) {\n          width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue] : 0;\n        } else if (_this.geoLess && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.stackSkip) {\n          width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : 0;\n        } else if (_this.sideSkip) {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]];\n        } else {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]];\n        }\n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX: function _newX(d, i) {\n        var prevSbl = this.previousSibling;\n        if (prevSbl) {\n          var prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        } else {\n          d[\"x_\"] = 0;\n        }\n        return d.x_;\n      }\n    };\n  },\n\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready: function ready() {\n    var _this2 = this;\n\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    var _this = this;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.shiftScale = d3.scaleLinear().domain([this.timeSteps[0], this.timeSteps[this.timeSteps.length - 1]]).range([0, this.timeSteps.length - 1]);\n\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.side = this.model.marker.label_side.getEntity();\n    this.SIDEDIM = this.side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.stack = this.model.marker.label_stack.getEntity();\n    this.STACKDIM = this.stack.getDimension() || this.model.marker.color.which;\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.age = this.model.marker.axis_y.getEntity();\n    this.AGEDIM = this.SHIFTEDAGEDIM = this.age.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n    this.groupBy = this.age.grouping || 1;\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n\n    this.frame = null;\n    this.model.marker.getFrame(_this.model.time.value, function (frame) {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n      _this.model.marker_order.getFrame(_this.model.time.value, function (frameOrder) {\n        _this.frameOrder = frameOrder.hook_order;\n        _this._createLimits();\n        _this._updateLimits();\n\n        _this._reorderBars();\n        _this.markers = _this2.model.marker.getKeys(_this.AGEDIM);\n\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n      });\n    });\n  },\n  updateUIStrings: function updateUIStrings() {\n    var _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    var xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-treemenu\").markerID(\"axis_x\").alignX(_this.model.locale.isRTL() ? \"right\" : \"left\").alignY(\"top\").updateView().toggle();\n    });\n\n    var conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion).select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\").style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", function () {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function () {\n      if (_this.model.time.dragging) return;\n      var rect = this.getBBox();\n      var coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      var toolRect = _this.root.element.getBoundingClientRect();\n      var chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", function () {\n      if (_this.model.time.dragging) return;\n      _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n    });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators: function _updateIndicators() {\n    var _this3 = this;\n\n    var _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    var sideDim = this.SIDEDIM;\n    var stackDim = this.STACKDIM;\n    var ageDim = this.AGEDIM;\n    var groupBy = this.groupBy;\n\n    var ages = this.model.marker.getKeys(ageDim);\n    var ageKeys = [];\n    ageKeys = ages.map(function (m) {\n      return m[ageDim];\n    });\n    this.shiftedAgeKeys = this.ageKeys = ageKeys;\n\n    //this.shiftedAgeKeys = this.timeSteps.map((m, i) => -i * groupBy).slice(1).reverse().concat(ageKeys);\n\n    var sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    var sideKeys = [];\n    if (!utils.isEmpty(sideItems)) {\n      var sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      var sides = this.model.marker.getKeys(sideDim).filter(function (f) {\n        return !sideFiltered || _this3.model.marker.side.getEntity().isShown(f);\n      });\n      sideKeys = sides.map(function (m) {\n        return m[sideDim];\n      });\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        var sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    var stacks = this.model.marker.color.use == \"indicator\" ? [] : this.model.marker.getKeys(stackDim);\n    var stackKeys = utils.without(stacks.map(function (m) {\n      if (m[stackDim] == _this.totalFieldName) _this.dataWithTotal = true;\n      return m[stackDim];\n    }), this.totalFieldName);\n\n    var sortedStackKeys = utils.keys(this.model.marker.color.getPalette()).reduce(function (arr, val) {\n      if (stackKeys.indexOf(val) != -1) arr.push(val);\n      return arr;\n    }, []);\n\n    if (sortedStackKeys.length != stackKeys.length) {\n      sortedStackKeys = stackKeys.reduce(function (arr, val) {\n        if (arr.indexOf(val) == -1) arr.push(val);\n        return arr;\n      }, sortedStackKeys);\n    }\n    this.stackKeys = sortedStackKeys;\n    this.stackItems = this.model.marker.label_stack.getItems();\n\n    this.stacked = this.ui.chart.stacked && this.model.marker.color.use != \"constant\" && this.stack.getDimension();\n\n    this.twoSided = this.sideKeys.length > 1;\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n      this.title.text(sideItems[this.sideKeys[1]]);\n      this.titleRight.text(sideItems[this.sideKeys[0]]);\n    } else {\n      var title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title);\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n  },\n  _reorderBars: function _reorderBars() {\n    var _this = this;\n    var domain = this.yScale.domain();\n    var sideKeys = this.sideKeys;\n    domain.sort(function (a, b) {\n      var result = d3.ascending(_this.frameOrder[a] || 0, _this.frameOrder[b] || 0);\n      return result !== 0 ? result : d3.ascending((_this.frameAxisX[sideKeys[0]] || [])[a] || 0, (_this.frameAxisX[sideKeys[0]] || [])[b] || 0);\n    });\n    this.yScale.domain(domain);\n  },\n  _createLimits: function _createLimits() {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    var sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    var keys = this.stackSkip && this.sideSkip ? [] : this.sideSkip ? [this.STACKDIM] : this.stackSkip ? [this.SIDEDIM] : [this.STACKDIM, this.SIDEDIM];\n    var limits = axisX.getLimitsByDimensions(keys.concat([this.AGEDIM, this.TIMEDIM]));\n    var timeKeys = axisX.getUnique();\n    var totals = {};\n    var inpercentMaxLimits = {};\n    var maxLimits = {};\n    sideKeysNF.forEach(function (s) {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.stackSkip && _this.sideSkip) {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        var ageSum = 0;\n        var sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, function (age) {\n          var stackSum = 0;\n          if (limits[age] && limits[age][time]) {\n            stackSum += limits[age][time].max;\n            ageSum += stackSum;\n          }\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.sideSkip) {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        var ageSum = 0;\n        var sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, function (age) {\n          var stackSum = 0;\n          utils.forEach(_this.stackKeys, function (stack) {\n            if (limits[stack] && limits[stack][age] && limits[stack][age][time]) {\n              stackSum += limits[stack][age][time].max;\n              ageSum += stackSum;\n            }\n          });\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.stackSkip) {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, function (side) {\n          var ageSum = 0;\n          var sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, function (age) {\n            var stackSum = 0;\n            if (limits[side] && limits[side][age] && limits[side][age][time]) {\n              stackSum += limits[side][age][time].max;\n              ageSum += stackSum;\n            }\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    } else {\n      utils.forEach(timeKeys, function (time) {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, function (side) {\n          var ageSum = 0;\n          var sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, function (age) {\n            var stackSum = 0;\n            utils.forEach(_this.stackKeys, function (stack) {\n              if (limits[stack][side] && limits[stack][side][age] && limits[stack][side][age][time]) {\n                stackSum += limits[stack][side][age][time].max;\n                ageSum += stackSum;\n              }\n            });\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          var maxSideLimit = Math.max.apply(Math, sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    this.maxLimits = {};\n    this.inpercentMaxLimits = {};\n    sideKeysNF.forEach(function (s) {\n      _this.maxLimits[s] = Math.max.apply(Math, _toConsumableArray(maxLimits[s]));\n      _this.inpercentMaxLimits[s] = Math.max.apply(Math, _toConsumableArray(inpercentMaxLimits[s]));\n    });\n    this.totals = totals;\n  },\n  _updateLimits: function _updateLimits() {\n    var _this = this;\n    var axisX = this.model.marker.axis_x;\n    var zero = axisX.scaleType == \"log\" ? 0.01 : 0;\n    var domain = void 0;\n    if (this.ui.chart.inpercent) {\n      domain = [zero * 0.01, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n        return _this.inpercentMaxLimits[s];\n      })))];\n    } else {\n      domain = axisX.domainMin != null && axisX.domainMax != null ? [+axisX.domainMin, +axisX.domainMax] : [zero, Math.max.apply(Math, _toConsumableArray(this.sideKeys.map(function (s) {\n        return _this.maxLimits[s];\n      })))];\n    }\n    this.xScale.domain(domain);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n  },\n  _interpolateBetweenTotals: function _interpolateBetweenTotals(timeSteps, totals, time) {\n    var nextStep = d3.bisectLeft(timeSteps, time);\n    var fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    var total = {};\n    utils.forEach(this.sideKeys, function (side) {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n    });\n    return total;\n  },\n\n\n  /**\n   * Updates entities\n   */\n  _updateEntities: function _updateEntities(reorder) {\n\n    var _this = this;\n    var time = this.model.time;\n    var sideDim = this.SIDEDIM;\n    var prefixedSideDim = this.PREFIXEDSIDEDIM;\n    var ageDim = this.AGEDIM;\n    var stackDim = this.STACKDIM;\n    var prefixedStackDim = this.PREFIXEDSTACKDIM;\n    var timeDim = this.TIMEDIM;\n    var duration = time.playing ? time.delayAnimations : 0;\n    var total = void 0;\n\n    var groupBy = this.groupBy;\n    //var group_offset = this.model.marker.group_offset ? Math.abs(this.model.marker.group_offset % groupBy) : 0;\n\n    if (this.ui.chart.inpercent) {\n      this.total = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n    }\n\n    var domain = this.yScale.domain();\n\n    //this.model.age.setVisible(markers);\n\n    //const nextStep = d3.bisectLeft(this.timeSteps, time.value);\n\n    var shiftedAgeDim = this.SHIFTEDAGEDIM;\n\n    //   const markers = this.markers.map(data => {\n    //       const o = {};\n    //   o[ageDim] = o[shiftedAgeDim] = +data[ageDim];\n    //   o[ageDim] -= nextStep * groupBy;\n    //   return o;\n    // });\n\n    var ageBars = this.markers.slice(0);\n\n    // const outAge = {};\n    // outAge[shiftedAgeDim] = markers.length * groupBy;\n    // outAge[ageDim] = outAge[shiftedAgeDim] - nextStep * groupBy;\n\n    //this.ageShift = 0;//= nextStep * groupBy;\n\n    // if (nextStep) ageBars.push(outAge);\n\n    this.entityBars = this.bars.selectAll(\".vzb-bc-bar\").data(ageBars, function (d) {\n      return d[ageDim];\n    });\n    //exit selection\n    this.entityBars.exit().remove();\n\n    var oneBarHeight = this.oneBarHeight;\n    var barHeight = this.barHeight;\n    var firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    this.entityBars = this.entityBars.enter().append(\"g\").attr(\"class\", function (d) {\n      return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    }\n    //  .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - groupBy) * oneBarHeight) + \")\")\n    ).attr(\"transform\", function (d, i) {\n      return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\";\n    }).merge(this.entityBars);\n\n    // this.entityBars.attr(\"class\", function(d) {\n    //     return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    //   })\n\n\n    this.sideBars = this.entityBars.selectAll(\".vzb-bc-side\").data(function (d) {\n      return _this.sideKeys.map(function (m) {\n        var r = {};\n        r[ageDim] = d[ageDim];\n        r[shiftedAgeDim] = d[shiftedAgeDim];\n        r[prefixedSideDim] = m;\n        r[sideDim] = m;\n        return r;\n      });\n    }, function (d) {\n      return d[prefixedSideDim];\n    });\n\n    this.sideBars.exit().remove();\n    this.sideBars = this.sideBars.enter().append(\"g\").attr(\"class\", function (d, i) {\n      return \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\");\n    }).merge(this.sideBars);\n\n    if (reorder) {\n      this.sideBars.attr(\"transform\", function (d, i) {\n        return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n      });\n    }\n\n    var _attributeUpdaters = this._attributeUpdaters;\n\n    this.stackBars = this.sideBars.selectAll(\".vzb-bc-stack\").data(function (d, i) {\n      var stacks = _this.stacked ? _this.stackKeys : [_this.totalFieldName];\n      return stacks.map(function (m) {\n        var r = {};\n        r[ageDim] = d[ageDim];\n        r[shiftedAgeDim] = d[shiftedAgeDim];\n        r[sideDim] = d[sideDim];\n        r[stackDim] = m;\n        r[prefixedSideDim] = d[prefixedSideDim];\n        r[prefixedStackDim] = m;\n        return r;\n      });\n    }, function (d) {\n      return d[prefixedStackDim];\n    });\n\n    this.stackBars.exit().remove();\n    this.stackBars = this.stackBars.enter().append(\"rect\").attr(\"class\", function (d, i) {\n      return \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\");\n    }).attr(\"y\", 0).attr(\"height\", barHeight).attr(\"fill\", function (d) {\n      return _this.cScale(_this.colorUseNotProperty ? _this.frame.color[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : d[prefixedStackDim]);\n    }).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX).on(\"mouseover\", _this.interaction.mouseover).on(\"mouseout\", _this.interaction.mouseout).on(\"click\", _this.interaction.click).onTap(_this.interaction.tap).merge(this.stackBars);\n\n    if (reorder) this.stackBars.attr(\"fill\", function (d) {\n      return _this.cScale(_this.colorUseNotProperty ? _this.frame.color[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : d[prefixedStackDim]);\n    }).order();\n\n    var stepShift = ageBars[0][shiftedAgeDim] - ageBars[0][ageDim] - this.shiftScale(time.value) * groupBy;\n\n    if (duration) {\n      var transition = d3.transition().duration(duration).ease(d3.easeLinear);\n\n      this.entityBars\n      //.transition(transition)\n      .attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\";\n      });\n      //        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      this.stackBars.transition(transition).attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      this.entityBars.interrupt().attr(\"transform\", function (d, i) {\n        return \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\";\n      });\n      //        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      this.stackBars.interrupt().attr(\"width\", _attributeUpdaters._newWidth).attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    // this.entityLabels = this.labels.selectAll(\".vzb-bc-label\")\n    //   .data(this.markers, d => d[ageDim]);\n    // //exit selection\n    // this.entityLabels.exit().remove();\n\n    // const entityLabels = this.entityLabels.enter().append(\"g\")\n    //   .attr(\"class\", \"vzb-bc-label\")\n    //   .attr(\"id\", d => \"vzb-bc-label-\" + d[shiftedAgeDim] + \"-\" + _this._id)\n    // entityLabels.append(\"text\")\n    //   .attr(\"class\", \"vzb-bc-age\")\n    //   .attr(\"y\", (d, i) => firstBarOffsetY - _this.yScale(d[shiftedAgeDim]) - 10);\n\n    // this.entityLabels = entityLabels.merge(this.entityLabels);\n    // // .style(\"fill\", function(d) {\n    // //   var color = _this.cScale(values.color[d[ageDim]]);\n    // //   return d3.rgb(color).darker(2);\n    // // });\n\n    // if (reorder) this.entityLabels.selectAll(\".vzb-bc-age\").attr(\"y\", (d, i) => firstBarOffsetY - _this.yScale(d[shiftedAgeDim]) - 10);\n\n    if (duration) {\n      this.year.transition().duration(duration).ease(d3.easeLinear).on(\"end\", this._setYear(time.value));\n    } else {\n      this.year.interrupt().text(time.formatDate(time.value)).transition();\n    }\n  },\n  _setYear: function _setYear(timeValue) {\n    var formattedTime = this.model.time.formatDate(timeValue);\n    return function () {\n      d3.select(this).text(formattedTime);\n    };\n  },\n  _interaction: function _interaction() {\n    var _this = this;\n    return {\n      mouseover: function mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        //_this._showLabel(d);\n      },\n      mouseout: function mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click: function click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap: function tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n  _highlightBars: function _highlightBars(d) {\n    var _this = this;\n\n    _this.someHighlighted = _this.model.marker.highlight.length > 0;\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    } else {\n      _this._showLabel(_this.model.marker.highlight[0]);\n    }\n  },\n  _showLabel: function _showLabel(d) {\n    var _this = this;\n    var formatter = _this.ui.chart.inpercent ? d3.format(\".1%\") : _this.model.marker.axis_x.getTickFormatter();\n    var sideDim = _this.SIDEDIM;\n    var ageDim = _this.AGEDIM;\n    var stackDim = _this.STACKDIM;\n    var KEYS = this.KEYS;\n\n    var left = _this.sideKeys.indexOf(d[sideDim]);\n    var label = _this.labels.select(\".vzb-bc-label\");\n    var bar = _this.bars.select(\".vzb-bc-bar-\" + d[ageDim]);\n    //const label = _this.labels.select(\"#vzb-bc-label-\" + d[ageDim] + \"-\" + _this._id);\n    label.attr(\"transform\", bar.attr(\"transform\")).select(\".vzb-bc-age\").text(function (textData) {\n      //var total = _this.ui.chart.inpercent ? _this.totalValues[d[sideDim]] : 1;\n      var text = _this.stackKeys.length > 1 ? _this.stackItems[d[stackDim]] : _this.frame.label_age[d[ageDim]];\n      text = _this.twoSided ? text : text + \" \" + _this.stackItems[d[stackDim]];\n      var value = utils.getValueMD(d, _this.frameAxisX, KEYS); //_this.xScale.invert(d[\"width_\"]);\n      //var value = (_this.dataWithTotal || _this.stacked) ? _this.values1.axis_x[d[shiftedAgeDim]][d[sideDim]][d[stackDim]] / total : _this.xScale.invert(d[\"width_\"]);\n      return text + \": \" + formatter(value);\n    }).attr(\"x\", (left ? -1 : 1) * (_this.activeProfile.centerWidth * 0.5 + 7)).classed(\"vzb-text-left\", left);\n\n    label.classed(\"vzb-hovered\", true);\n  },\n\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { right: 80, bottom: 80 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 100, right: 100, left: 100, bottom: 80 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 70,\n        right: 20,\n        left: 40,\n        bottom: 40\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 100,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize: function resize() {\n\n    var _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    //this.activeProfile = this.profiles[this.getLayoutProfile()];\n    var margin = this.activeProfile.margin;\n    var infoElHeight = this.activeProfile.infoElHeight;\n\n    //stage\n    this.height = parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom || 0;\n    this.width = parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right || 0;\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"Pop by age resize() abort: vizabi container is too little or has display:none\");\n\n    this.graph.attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.barsCrop.attr(\"width\", this.width).attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop.attr(\"width\", this.width).attr(\"height\", Math.max(0, this.height));\n\n    var groupBy = this.groupBy;\n\n    var domain = this.yScale.domain();\n    this.oneBarHeight = this.model.marker.axis_y.scaleType == \"ordinal\" ? this.height / domain.length : this.height / (domain[1] - domain[0]);\n    var barHeight = this.barHeight = this.oneBarHeight * groupBy; // height per bar is total domain height divided by the number of possible markers in the domain\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight);\n\n    if (this.sideBars) this.sideBars.attr(\"transform\", function (d, i) {\n      return i ? \"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\" : \"\";\n    });\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n\n    var maxRange = this.twoSided ? (this.width - this.activeProfile.centerWidth) * 0.5 : this.width;\n\n    this.xScale.range([0, maxRange]);\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale).tickValues([]).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width, 0).labelerOptions({\n      scaleType: this.model.marker.axis_y.scaleType,\n      toolMargin: margin,\n      limitMaxTickNumber: 1\n    });\n\n    var format = this.ui.chart.inpercent ? d3.format((groupBy > 3 ? \"\" : \".1\") + \"%\") : this.model.marker.axis_x.getTickFormatter();\n\n    this.xAxis.scale(this.xScale).tickFormat(format).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height, 0).labelerOptions({\n      scaleType: this.model.marker.axis_x.scaleType,\n      toolMargin: margin,\n      limitMaxTickNumber: 6\n    });\n\n    var translateX = this.twoSided ? (this.width + _this.activeProfile.centerWidth) * 0.5 : 0;\n\n    this.xAxisEl.attr(\"transform\", \"translate(\" + translateX + \",\" + this.height + \")\").call(this.xAxis);\n\n    this.yAxisEl.attr(\"transform\", \"translate(\" + 0 + \",0)\").call(this.yAxis);\n    //this.xAxisEl.call(this.xAxis);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n        this.xScaleLeft.range([(this.width - this.activeProfile.centerWidth) * 0.5, 0]);\n      } else {\n        this.xScaleLeft.rangePoints([(this.width - this.activeProfile.centerWidth) * 0.5, 0]).range();\n      }\n\n      this.xAxisLeft.scale(this.xScaleLeft).tickFormat(format).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height, 0).labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n      this.xAxisLeftEl.attr(\"transform\", \"translate(0,\" + this.height + \")\").call(this.xAxisLeft);\n      var zeroTickEl = this.xAxisEl.select(\".tick text\");\n      if (!zeroTickEl.empty()) {\n        var zeroTickWidth = zeroTickEl.node().getBBox().width;\n        zeroTickEl.attr(\"dx\", -(this.activeProfile.centerWidth + zeroTickWidth) * 0.5);\n      }\n      this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n\n      //hide left axis zero tick\n      var tickNodes = this.xAxisLeftEl.selectAll(\".tick\").nodes();\n      d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n    }\n\n    var isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n    this.labels.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n\n    this.title.attr(\"x\", margin.left + (this.twoSided ? translateX - this.activeProfile.titlesSpacing : 0)).style(\"text-anchor\", this.twoSided ? \"end\" : \"\").attr(\"y\", margin.top * 0.7);\n    this.titleRight.attr(\"x\", margin.left + translateX + this.activeProfile.titlesSpacing).attr(\"y\", margin.top * 0.7);\n\n    this.xTitleEl.style(\"font-size\", infoElHeight + \"px\").attr(\"transform\", \"translate(\" + (isRTL ? this.width : margin.left * 0.4) + \",\" + margin.top * 0.4 + \")\");\n    this.xTitleEl.select(\"text\").text(this.model.marker.axis_x.getConceptprops().name);\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      var titleBBox = this.xTitleEl.node().getBBox();\n      var t = utils.transform(this.xTitleEl.node());\n      var hTranslate = isRTL ? titleBBox.x + t.translateX - infoElHeight * 1.4 : titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4;\n\n      this.xInfoEl.select(\"svg\").attr(\"width\", infoElHeight + \"px\").attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\" + hTranslate + \",\" + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n    this.year.attr(\"x\", this.width + margin.left).attr(\"y\", margin.top * 0.4);\n  },\n  updateBarsOpacity: function updateBarsOpacity(duration) {\n    var _this = this;\n    //if(!duration)duration = 0;\n\n    var OPACITY_HIGHLT = 1.0;\n    var OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    var OPACITY_SELECT = this.model.marker.opacityRegular;\n    var OPACITY_REGULAR = this.model.marker.opacityRegular;\n    var OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.stackBars\n    //.transition().duration(duration)\n    .style(\"opacity\", function (d) {\n\n      if (_this.someHighlighted) {\n        //highlight or non-highlight\n        if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n      }\n\n      if (_this.someSelected) {\n        //selected or non-selected\n        return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n      }\n\n      if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n      return OPACITY_REGULAR;\n    });\n\n    this.stackBars.style(\"stroke\", function (d) {\n      return _this.model.marker.isSelected(d) ? \"#333\" : null;\n    });\n\n    var nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.stackBars.style(\"pointer-events\", function (d) {\n        return !_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d) ? \"visible\" : \"none\";\n      });\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n});\n\nexports.default = BarChartDS;\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n// removed by extract-text-webpack-plugin\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports) {\n\nmodule.exports = \"<!-- BarChartDS Component -->\\n<svg class=\\\"vzb-barchartds\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-year\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\">\\n                <g class=\\\"vzb-bc-label\\\"><text class=\\\"vzb-bc-age\\\"></text></g>\\n            </g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n</svg>\\n\";\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\nmodule.exports = __webpack_require__(0);\n\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// barchart-ds.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap e870d5d419cbde515963","import \"./styles.scss\";\nimport component from \"./component\";\n\nconst VERSION_INFO = { version: __VERSION, build: __BUILD };\n\n//BAR CHART TOOL\nconst BarChartDS = Vizabi.Tool.extend(\"BarChartDS\", {\n\n  /**\n   * Initializes the tool (Bar Chart Tool).\n   * Executed once before any template is rendered.\n   * @param {Object} placeholder Placeholder element for the tool\n   * @param {Object} external_model Model as given by the external page\n   */\n  init(placeholder, external_model) {\n\n    this.name = \"barchartds\";\n\n    //specifying components\n    this.components = [{\n      component,\n      placeholder: \".vzb-tool-viz\",\n      model: [\"state.time\", \"state.marker\", \"state.marker_order\", \"state.entities\", \"state.entities_side\", \"state.entities_allpossible\", \"state.entities_geodomain\", \"locale\", \"ui\"] //pass models to component\n    }, {\n      component: Vizabi.Component.get(\"timeslider\"),\n      placeholder: \".vzb-tool-timeslider\",\n      model: [\"state.time\", \"state.entities\", \"state.marker\", \"ui\"]\n    }, {\n      component: Vizabi.Component.get(\"dialogs\"),\n      placeholder: \".vzb-tool-dialogs\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"buttonlist\"),\n      placeholder: \".vzb-tool-buttonlist\",\n      model: [\"state\", \"ui\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"treemenu\"),\n      placeholder: \".vzb-tool-treemenu\",\n      model: [\"state.marker\", \"state.marker_tags\", \"state.time\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"datanotes\"),\n      placeholder: \".vzb-tool-datanotes\",\n      model: [\"state.marker\", \"locale\"]\n    }, {\n      component: Vizabi.Component.get(\"steppedspeedslider\"),\n      placeholder: \".vzb-tool-stepped-speed-slider\",\n      model: [\"state.time\", \"locale\"]\n    }];\n\n    //constructor is the same as any tool\n    this._super(placeholder, external_model);\n  },\n\n  validate(model) {\n    model = this.model || model;\n\n    this._super(model);\n\n    //validate on first model set only\n    if (!this.model) {\n      const entities = model.state.entities;\n      if (Object.keys(entities.show).length > 0) {\n        const show = {};\n        if (entities.show[entities.dim] && Object.keys(entities.show).length !== 1) {\n          show[entities.dim] = entities.show[entities.dim];\n        }\n        if (!entities.show[entities.dim] || !(Object.keys(entities.show).length == 1)) {\n          entities.show = show;\n        }\n      }\n\n      const entities_geodomain = model.state.entities_geodomain;\n      entities_geodomain.skipFilter = model.state.entities.dim === entities_geodomain.dim ||\n        model.state.entities_side.dim === entities_geodomain.dim || model.state.entities_allpossible.dim === entities_geodomain.dim;\n    }\n  },\n\n  default_model: {\n    state: {\n      marker_tags: {}\n    },\n    ui: {\n      chart: {\n        stacked: true,\n        inpercent: false,\n        flipSides: true\n      },\n      \"buttons\": [\"colors\", \"inpercent\", \"find\", \"side\", \"moreoptions\", \"fullscreen\"],\n      \"dialogs\": {\n        \"popup\": [\"timedisplay\", \"colors\", \"find\", \"side\", \"moreoptions\"],\n        \"sidebar\": [\"timedisplay\", \"colors\", \"find\"],\n        \"moreoptions\": [\"opacity\", \"speed\", \"colors\", \"side\", \"presentation\", \"about\"]\n      },\n      presentation: false\n    },\n    locale: { }\n  },\n\n  versionInfo: VERSION_INFO\n});\n\nexport default BarChartDS;\n\n\n\n// WEBPACK FOOTER //\n// ./src/index.js","const {\n  utils,\n  Component,\n  helpers: {\n    \"d3.axisWithLabelPicker\": axisSmart\n  },\n  iconset: {\n    question: iconQuestion\n  },\n} = Vizabi;\n\n// POP BY AGE CHART COMPONENT\nconst BarChartDS = Component.extend(\"barchartds\", {\n\n  /**\n   * Initializes the component (Bar Chart).\n   * Executed once before any template is rendered.\n   * @param {Object} config The config passed to the component\n   * @param {Object} context The component's parent\n   */\n  init(config, context) {\n    this.name = \"barchartds\";\n    this.template = require(\"./template.html\");\n\n    //define expected models for this component\n    this.model_expects = [{\n      name: \"time\",\n      type: \"time\"\n    }, {\n      name: \"marker\",\n      type: \"model\"\n    }, {\n      name: \"marker_order\",\n      type: \"model\"\n    }, {\n      name: \"entities\",\n      type: \"entities\"\n    }, {\n      name: \"entities_side\",\n      type: \"entities\"\n    }, {\n      name: \"entities_allpossible\",\n      type: \"entities\"\n    }, {\n      name: \"entities_geodomain\",\n      type: \"entities\"\n    }, {\n      name: \"locale\",\n      type: \"locale\"\n    }, {\n      name: \"ui\",\n      type: \"ui\"\n    }];\n\n    const _this = this;\n    this.model_binds = {\n      \"change:time.value\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.time.step != 1 && !_this.snapped && !_this.model.time.playing && !_this.model.time.dragging) {\n          let next = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          if (next != 0 && (_this.timeSteps[next] - _this.model.time.value)) {\n            _this.snapped = true;\n            const time = _this.model.time.value;\n            const prev = _this.timeSteps[next - 1];\n            next = _this.timeSteps[next];\n            const snapTime = (time - prev) < (next - time) ? prev : next;\n            _this.model.time.value = new Date(snapTime);\n          }\n        }\n        if (!_this.snapped) {\n//          if (_this.timeSteps.filter(t => (t - _this.model.time.value) == 0).length) {\n            _this.model.marker.getFrame(_this.model.time.value, frame => {\n              _this.frame = frame;\n              _this.frameAxisX = frame.axis_x;\n              _this.model.marker_order.getFrame(_this.model.time.value, frameOrder => {\n                _this.frameOrder = frameOrder.hook_order;\n\n                _this._reorderBars();\n                _this._updateEntities(true);\n                _this.updateBarsOpacity();\n              });\n            });\n          // } else {\n          //   const nextIndex = d3.bisectLeft(_this.timeSteps, _this.model.time.value);\n          //   const prevFrameTime = _this.timeSteps[nextIndex - 1];\n          //   const nextFrameTime = _this.timeSteps[nextIndex];\n          //   const fraction = (_this.model.time.value - prevFrameTime) / (nextFrameTime - prevFrameTime);\n          //   _this.model.marker.getFrame(nextFrameTime, nValues => {\n          //     _this.model.marker.getFrame(prevFrameTime, pValues => {\n          //       _this.frameAxisX = _this.interpolateDiagonal(pValues.axis_x, nValues.axis_x, fraction);\n          //       _this._updateEntities();\n          //       _this.updateBarsOpacity();\n          //     });\n          //   });\n          // }\n        }\n        _this.snapped = false;\n      },\n      \"change:marker\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        if (path.indexOf(\"scaleType\") > -1) {\n          _this.ready();\n          return;\n        }\n      },\n      \"change:marker.select\": function(evt) {\n        _this.someSelected = (_this.model.marker.select.length > 0);\n        _this.nonSelectedOpacityZero = false;\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.highlight\": function(evt, path) {\n        if (!_this._readyOnce) return;\n        _this._highlightBars();\n      },\n      \"change:marker.opacitySelectDim\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.opacityRegular\": function() {\n        _this.updateBarsOpacity();\n      },\n      \"change:marker.color.palette\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.scaleType\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateEntities();\n      },\n      \"change:marker.color.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        let stackDim;\n        const show = {};\n        if (_this.model.marker.color.use == \"constant\") {\n          stackDim = null;\n        } else {\n          const colorConcept = _this.model.marker.color.getConceptprops();\n          if (colorConcept.concept_type == \"entity_set\") {\n            stackDim = colorConcept.domain;\n            show[\"is--\" + _this.model.marker.color.which] = true;\n            const sideConcept = _this.model.marker.side.getConceptprops();\n            if (sideConcept.concept_type == \"entity_set\" && stackDim == sideConcept.domain && _this.model.marker.side.which !== _this.model.marker.color.which) {\n              _this.model.marker.side.setWhich({\"concept\" : _this.model.marker.color.which});\n            }          \n          } else {\n            stackDim = _this.model.marker.color.which;\n          }\n        }\n        _this.model.entities_geodomain.skipFilter = stackDim === _this.geoDomainDimension || _this.SIDEDIM === _this.geoDomainDimension;\n        _this.model.entities.set(\"show\", show);\n        _this.model.entities.set(\"dim\", stackDim);\n        _this.model.entities_allpossible.set(\"dim\", _this.model.marker.color.which);\n      },\n      \"change:marker.side.which\": function(evt) {\n        if (!_this._readyOnce) return;\n        let sideDim;\n        if (_this.model.marker.side.use == \"constant\") {\n          sideDim = null;\n        } else {\n          const sideConcept = _this.model.marker.side.getConceptprops();\n          if (sideConcept.concept_type == \"entity_set\") {\n            sideDim = sideConcept.domain;\n            const colorConcept = _this.model.marker.color.getConceptprops();\n            if (colorConcept.concept_type == \"entity_set\" && sideDim == colorConcept.domain && _this.model.marker.color.which !== _this.model.marker.side.which) {\n              _this.model.marker.color.setWhich({\"concept\" : _this.model.marker.side.which});\n            }          \n          } else {\n            sideDim = _this.model.marker.side.which;\n          }\n        } \n//        const sideDim = _this.model.marker.side.use == \"constant\" ? null : _this.model.marker.side.which;\n        _this.model.entities_geodomain.skipFilter = sideDim === _this.geoDomainDimension || _this.STACKDIM === _this.geoDomainDimension;\n        _this.model.marker.side.clearSideState();\n        _this.model.entities_side.clearShow();\n        _this.model.entities_side.set(\"dim\", sideDim);\n      },\n      \"change:entities.show\": function(evt) {\n        if (!_this._readyOnce) return;\n        if (_this.model.entities.dim === _this.model.entities_side.dim\n          && !utils.isEmpty(_this.model.entities.show)\n          && _this.model.entities.show[_this.model.entities.dim]\n          && !utils.isEmpty(_this.model.entities_side.show)) {\n          utils.forEach(_this.model.entities_side.getFilteredEntities(), s => {\n            if (!_this.model.entities.isShown(s)) {\n              _this.model.marker.side.clearSideState();\n              _this.model.entities_side.showEntity(s);\n            }\n          });\n        }\n      },\n      \"change:entities_side.show\": function(evt) {\n        if (!_this._readyOnce) return;\n\n        let doReturn = false;\n        let _entitiesSameDimWithSide = null;\n        utils.forEach(_this.model.marker.side._space, h => {\n          if (h.dim === _this.model.entities_side.dim && h._name !== _this.model.entities_side._name && h._name !== _this.model.entities_geodomain._name) {\n            _entitiesSameDimWithSide = h;\n          }\n        });\n        if (_entitiesSameDimWithSide && !utils.isEmpty(_entitiesSameDimWithSide.show) && _entitiesSameDimWithSide.show[_entitiesSameDimWithSide.dim]) {\n          utils.forEach(_this.model.entities_side.getFilteredEntities(), s => {\n            if (!_entitiesSameDimWithSide.isShown(s)) {\n              _entitiesSameDimWithSide.showEntity(s);\n              doReturn = true;\n            }\n          });\n        }\n        if (doReturn) return;\n\n        _this._updateIndicators();\n        if (!_this.model.ready || !_this.frame) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.inpercent\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this._updateLimits();\n        _this.resize();\n        _this._updateEntities();\n      },\n      \"change:ui.chart.flipSides\": function(evt) {\n        if (!_this._readyOnce) return;\n        _this.model.marker.side.switchSideState();\n        _this._updateIndicators();\n        _this.resize();\n        _this._updateEntities();\n      }\n    };\n\n    //contructor is the same as any component\n    this._super(config, context);\n\n    this.xScale = null;\n    this.yScale = null;\n    this.cScale = null;\n\n    this.xAxis = axisSmart(\"bottom\");\n    this.xAxisLeft = axisSmart(\"bottom\");\n    this.yAxis = axisSmart(\"left\");\n    this.xScales = [];\n    //this.SHIFTEDAGEDIM = \"s_age\";\n\n    this.totalFieldName = \"Total\";\n  },\n\n  // afterPreload: function() {\n  //   var obj = {};\n  //   obj[\"which\"] = this.model.marker.axis_x.which;\n  //   obj[\"use\"] = this.model.marker.axis_x.use;\n  //   this.model.marker_side.hook_total.set(obj);\n  // },\n\n  checkDimensions() {\n    const stackDim = this.model.entities.dim;\n    const sideDim = this.model.entities_side.dim;\n\n    this.colorUseNotProperty = this.model.marker.color.use == \"constant\" || this.model.marker.color.use == \"indicator\";\n    this.stackSkip = this.colorUseNotProperty || stackDim == sideDim;\n    this.geoLess = stackDim !== this.geoDomainDimension && sideDim !== this.geoDomainDimension && this.AGEDIM !== this.geoDomainDimension;\n    this.sideSkip = this.model.marker.side.use == \"constant\";\n  },\n\n  /**\n   * DOM is ready\n   */\n  readyOnce() {\n    const _this = this;\n    this.el = (this.el) ? this.el : d3.select(this.element);\n    this.element = this.el;\n\n    this.interaction = this._interaction();\n\n    this.graph = this.element.select(\".vzb-bc-graph\");\n    this.yAxisEl = this.graph.select(\".vzb-bc-axis-y\");\n    this.xAxisEl = this.graph.select(\".vzb-bc-axis-x\");\n    this.xAxisLeftEl = this.graph.select(\".vzb-bc-axis-x-left\");\n    this.xTitleEl = this.element.select(\".vzb-bc-axis-x-title\");\n    this.xInfoEl = this.element.select(\".vzb-bc-axis-x-info\");\n    this.yTitleEl = this.graph.select(\".vzb-bc-axis-y-title\");\n    this.barsCrop = this.graph.select(\".vzb-bc-bars-crop\");\n    this.labelsCrop = this.graph.select(\".vzb-bc-labels-crop\");\n    this.bars = this.graph.select(\".vzb-bc-bars\");\n    this.labels = this.graph.select(\".vzb-bc-labels\");\n    this.labels.select(\".vzb-bc-age\").attr(\"y\", -10);\n\n    this.title = this.element.select(\".vzb-bc-title\");\n    this.titleRight = this.element.select(\".vzb-bc-title-right\");\n    this.year = this.element.select(\".vzb-bc-year\");\n\n    this.geoDomainDimension = this.model.entities_geodomain.getDimension();\n    this.geoDomainDefaultValue = this.model.entities_geodomain.show[this.geoDomainDimension][\"$in\"][0];\n\n    _this.someSelected = (_this.model.marker.select.length > 0);\n    _this.nonSelectedOpacityZero = false;\n\n\n    this.on(\"resize\", () => {\n      _this._updateEntities();\n  });\n\n    this._attributeUpdaters = {\n      _newWidth(d, i) {\n        d[\"x_\"] = 0;\n        let width;\n        if (_this.geoLess && _this.stackSkip && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.geoLess && _this.stackSkip) {\n          width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? (_this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue] : 0;\n        } else if (_this.geoLess && _this.sideSkip) {\n          width = (_this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]] || {})[_this.geoDomainDefaultValue];\n        } else if (_this.stackSkip) {\n          width = _this.colorUseNotProperty || d[_this.PREFIXEDSIDEDIM] == d[_this.PREFIXEDSTACKDIM] ? _this.frameAxisX[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : 0;\n        } else if (_this.sideSkip) {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.AGEDIM]];\n        } else {\n          width = _this.frameAxisX[d[_this.PREFIXEDSTACKDIM]][d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]];\n        }\n        d[\"width_\"] = width ? _this.xScale(width) : 0;\n        if (_this.ui.chart.inpercent) {\n          d[\"width_\"] /= _this.total[d[_this.PREFIXEDSIDEDIM]];\n        }\n        return d.width_;\n      },\n      _newX(d, i) {\n        const prevSbl = this.previousSibling;\n        if (prevSbl) {\n          const prevSblDatum = d3.select(prevSbl).datum();\n          d[\"x_\"] = prevSblDatum.x_ + prevSblDatum.width_;\n        } else {\n          d[\"x_\"] = 0;\n        }\n        return d.x_;\n      }\n    };\n  },\n\n  /*\n   * Both model and DOM are ready\n   */\n  ready() {\n    //TODO: get component ready if some submodel doesn't ready ??????\n    if (!this.model.marker._ready) return;\n\n    const _this = this;\n\n    this.timeSteps = this.model.time.getAllSteps();\n\n    this.shiftScale = d3.scaleLinear()\n      .domain([this.timeSteps[0], this.timeSteps[this.timeSteps.length - 1]])\n      .range([0, this.timeSteps.length - 1]);\n\n    this.KEYS = utils.unique(this.model.marker._getAllDimensions({ exceptType: \"time\" }));\n    this.side = this.model.marker.label_side.getEntity();\n    this.SIDEDIM = this.side.getDimension();\n    this.PREFIXEDSIDEDIM = \"side_\" + this.SIDEDIM;\n    this.stack = this.model.marker.label_stack.getEntity();\n    this.STACKDIM = this.stack.getDimension() || this.model.marker.color.which;\n    this.PREFIXEDSTACKDIM = \"stack_\" + this.STACKDIM;\n    this.age = this.model.marker.axis_y.getEntity();\n    this.AGEDIM = this.SHIFTEDAGEDIM = this.age.getDimension();\n    this.TIMEDIM = this.model.time.getDimension();\n    this.groupBy = this.age.grouping || 1;\n    this.checkDimensions();\n    this.updateUIStrings();\n    this._updateIndicators();\n\n    this.frame = null;\n    this.model.marker.getFrame(_this.model.time.value, frame => {\n      _this.frame = frame;\n      _this.frameAxisX = frame.axis_x;\n      _this.model.marker_order.getFrame(_this.model.time.value, frameOrder => {\n        _this.frameOrder = frameOrder.hook_order;\n        _this._createLimits();\n        _this._updateLimits();\n  \n        _this._reorderBars();\n        _this.markers = this.model.marker.getKeys(_this.AGEDIM);\n\n        _this.resize();\n        _this._updateEntities(true);\n        _this.updateBarsOpacity();\n      });\n    });\n  },\n\n  updateUIStrings() {\n    const _this = this;\n    this.translator = this.model.locale.getTFunction();\n\n    const xTitle = this.xTitleEl.selectAll(\"text\").data([0]);\n    xTitle.enter().append(\"text\");\n    xTitle\n      .on(\"click\", () => {\n        _this.parent\n          .findChildByName(\"gapminder-treemenu\")\n          .markerID(\"axis_x\")\n          .alignX(_this.model.locale.isRTL() ? \"right\" : \"left\")\n          .alignY(\"top\")\n          .updateView()\n          .toggle();\n      });\n\n    const conceptPropsX = this.model.marker.axis_x.getConceptprops();\n    utils.setIcon(this.xInfoEl, iconQuestion)\n      .select(\"svg\").attr(\"width\", \"0px\").attr(\"height\", \"0px\")\n      .style('opacity', Number(Boolean(conceptPropsX.description || conceptPropsX.sourceLink)));\n\n    this.xInfoEl.on(\"click\", () => {\n      _this.parent.findChildByName(\"gapminder-datanotes\").pin();\n    });\n    this.xInfoEl.on(\"mouseover\", function() {\n      if (_this.model.time.dragging) return;\n      const rect = this.getBBox();\n      const coord = utils.makeAbsoluteContext(this, this.farthestViewportElement)(rect.x - 10, rect.y + rect.height + 10);\n      const toolRect = _this.root.element.getBoundingClientRect();\n      const chartRect = _this.element.node().getBoundingClientRect();\n      _this.parent.findChildByName(\"gapminder-datanotes\").setHook(\"axis_x\").show().setPos(coord.x + chartRect.left - toolRect.left, coord.y);\n    });\n    this.xInfoEl.on(\"mouseout\", () => {\n      if (_this.model.time.dragging) return;\n    _this.parent.findChildByName(\"gapminder-datanotes\").hide();\n  });\n\n    // var titleStringY = this.model.marker.axis_y.getConceptprops().name;\n\n    // var yTitle = this.yTitleEl.selectAll(\"text\").data([0]);\n    // yTitle.enter().append(\"text\");\n    // yTitle\n    //   .attr(\"y\", \"-6px\")\n    //   .attr(\"x\", \"-9px\")\n    //   .attr(\"dx\", \"-0.72em\")\n    //   .text(titleStringY);\n  },\n\n  /**\n   * Changes labels for indicators\n   */\n  _updateIndicators() {\n    const _this = this;\n    this.duration = this.model.time.delayAnimations;\n    this.yScale = this.model.marker.axis_y.getScale();\n    this.xScale = this.model.marker.axis_x.getScale();\n    this.yAxis.tickFormat(_this.model.marker.axis_y.getTickFormatter());\n    this.xAxis.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n    this.xAxisLeft.tickFormat(_this.model.marker.axis_x.getTickFormatter());\n\n    const sideDim = this.SIDEDIM;\n    const stackDim = this.STACKDIM;\n    const ageDim = this.AGEDIM;\n    const groupBy = this.groupBy;\n\n    const ages = this.model.marker.getKeys(ageDim);\n    let ageKeys = [];\n    ageKeys = ages.map(m => m[ageDim]);\n    this.shiftedAgeKeys = this.ageKeys = ageKeys;\n\n    //this.shiftedAgeKeys = this.timeSteps.map((m, i) => -i * groupBy).slice(1).reverse().concat(ageKeys);\n\n    const sideItems = this.model.marker.label_side.getItems();\n    //var sideKeys = Object.keys(sideItems);\n    let sideKeys = [];\n    if (!utils.isEmpty(sideItems)) {\n      const sideFiltered = !!this.model.marker.side.getEntity().show[sideDim];\n      const sides = this.model.marker.getKeys(sideDim)\n          .filter(f => !sideFiltered || this.model.marker.side.getEntity().isShown(f));\n      sideKeys = sides.map(m => m[sideDim]);\n\n      if (sideKeys.length > 2) sideKeys.length = 2;\n      if (sideKeys.length > 1) {\n        const sortFunc = this.ui.chart.flipSides ? d3.ascending : d3.descending;\n        sideKeys.sort(sortFunc);\n      }\n    }\n    if (!sideKeys.length) sideKeys.push(\"undefined\");\n    this.sideKeys = sideKeys;\n\n    const stacks = this.model.marker.color.use == \"indicator\" ? [] : this.model.marker.getKeys(stackDim);\n    const stackKeys = utils.without(stacks.map(m => {\n        if (m[stackDim] == _this.totalFieldName) _this.dataWithTotal = true;\n        return m[stackDim];\n      }), this.totalFieldName);\n\n    let sortedStackKeys = utils.keys(this.model.marker.color.getPalette()).reduce((arr, val) => {\n        if (stackKeys.indexOf(val) != -1) arr.push(val);\n        return arr;\n      }, []);\n\n    if (sortedStackKeys.length != stackKeys.length) {\n      sortedStackKeys = stackKeys.reduce((arr, val) => {\n          if (arr.indexOf(val) == -1) arr.push(val);\n          return arr;\n        }, sortedStackKeys);\n    }\n    this.stackKeys = sortedStackKeys;\n    this.stackItems = this.model.marker.label_stack.getItems();\n\n    this.stacked = this.ui.chart.stacked && this.model.marker.color.use != \"constant\" && this.stack.getDimension();\n\n    this.twoSided = this.sideKeys.length > 1;\n    this.titleRight.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      this.xScaleLeft = this.xScale.copy();\n      this.title.text(sideItems[this.sideKeys[1]]);\n      this.titleRight.text(sideItems[this.sideKeys[0]]);\n    } else {\n      const title = this.sideKeys.length && sideItems[this.sideKeys[0]] ? sideItems[this.sideKeys[0]] : \"\";\n      this.title.text(title);\n    }\n\n    this.cScale = this.model.marker.color.getScale();\n  },\n\n  _reorderBars() {\n    const _this = this;\n    const domain = this.yScale.domain();\n    const sideKeys = this.sideKeys;\n    domain.sort((a, b) => { \n      const result = d3.ascending(_this.frameOrder[a] || 0, _this.frameOrder[b] || 0);\n      return result !== 0 ? result : d3.ascending((_this.frameAxisX[sideKeys[0]]||[])[a] || 0, (_this.frameAxisX[sideKeys[0]]||[])[b] || 0);\n    });\n    this.yScale.domain(domain);\n  },\n\n  _createLimits() {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n\n    //const sideKeysNF = Object.keys(this.model.marker.side.getItems());\n    const sideKeysNF = Object.keys(this.model.marker.side.getNestedItems([this.SIDEDIM]));\n    if (!sideKeysNF.length) sideKeysNF.push(\"undefined\");\n\n    const keys = this.stackSkip && this.sideSkip ? [] : (this.sideSkip ? [this.STACKDIM] : (this.stackSkip ? [this.SIDEDIM] : [this.STACKDIM, this.SIDEDIM]));\n    const limits = axisX.getLimitsByDimensions(keys.concat([this.AGEDIM, this.TIMEDIM]));\n    const timeKeys = axisX.getUnique();\n    const totals = {};\n    const inpercentMaxLimits = {};\n    const maxLimits = {};\n    sideKeysNF.forEach(s => {\n      maxLimits[s] = [];\n      inpercentMaxLimits[s] = [];\n    });\n\n    if (_this.stackSkip && _this.sideSkip) {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        let ageSum = 0;\n        const sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, age => {\n          let stackSum = 0;\n          if (limits[age] && limits[age][time]) {\n            stackSum += limits[age][time].max;\n            ageSum += stackSum;\n          }\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        const maxSideLimit = Math.max(...sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.sideSkip) {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        let ageSum = 0;\n        const sideMaxLimits = [];\n        utils.forEach(_this.ageKeys, age => {\n          let stackSum = 0;\n            utils.forEach(_this.stackKeys, stack => {\n              if (limits[stack] && limits[stack][age] && limits[stack][age][time]) {\n              stackSum += limits[stack][age][time].max;\n              ageSum += stackSum;\n            }\n          });\n          sideMaxLimits.push(stackSum);\n        });\n        totals[time][sideKeysNF[0]] = ageSum;\n        const maxSideLimit = Math.max(...sideMaxLimits);\n        inpercentMaxLimits[sideKeysNF[0]].push(maxSideLimit / ageSum);\n        maxLimits[sideKeysNF[0]].push(maxSideLimit);\n      });\n    } else if (_this.stackSkip) {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, side => {\n          let ageSum = 0;\n          const sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, age => {\n            let stackSum = 0;\n            if (limits[side] && limits[side][age] && limits[side][age][time]) {\n              stackSum += limits[side][age][time].max;\n              ageSum += stackSum;\n            }\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          const maxSideLimit = Math.max(...sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    } else {\n      utils.forEach(timeKeys, time => {\n        totals[time] = {};\n        utils.forEach(sideKeysNF, side => {\n          let ageSum = 0;\n          const sideMaxLimits = [];\n          utils.forEach(_this.ageKeys, age => {\n            let stackSum = 0;\n            utils.forEach(_this.stackKeys, stack => {\n              if (limits[stack][side] && limits[stack][side][age] && limits[stack][side][age][time]) {\n                stackSum += limits[stack][side][age][time].max;\n                ageSum += stackSum;\n              }\n            });\n            sideMaxLimits.push(stackSum);\n          });\n          totals[time][side] = ageSum;\n          const maxSideLimit = Math.max(...sideMaxLimits);\n          inpercentMaxLimits[side].push(maxSideLimit / ageSum);\n          maxLimits[side].push(maxSideLimit);\n        });\n      });\n    }\n\n    this.maxLimits = {};\n    this.inpercentMaxLimits = {};\n    sideKeysNF.forEach(s => {\n      _this.maxLimits[s] = Math.max(...maxLimits[s]);\n      _this.inpercentMaxLimits[s] = Math.max(...inpercentMaxLimits[s]);\n    });\n    this.totals = totals;\n  },\n\n  _updateLimits() {\n    const _this = this;\n    const axisX = this.model.marker.axis_x;\n    const zero = axisX.scaleType == \"log\" ? 0.01 : 0;\n    let domain;\n    if (this.ui.chart.inpercent) {\n      domain = [zero * 0.01, Math.max(...this.sideKeys.map(s => _this.inpercentMaxLimits[s]))];\n    } else {\n      domain = (axisX.domainMin != null && axisX.domainMax != null) ? [+axisX.domainMin, +axisX.domainMax] : [zero, Math.max(...this.sideKeys.map(s => _this.maxLimits[s]))];\n    }\n    this.xScale.domain(domain);\n    if (this.xScaleLeft) this.xScaleLeft.domain(this.xScale.domain());\n  },\n\n\n  _interpolateBetweenTotals(timeSteps, totals, time) {\n    const nextStep = d3.bisectLeft(timeSteps, time);\n    const fraction = (time - timeSteps[nextStep - 1]) / (timeSteps[nextStep] - timeSteps[nextStep - 1]);\n    const total = {};\n    utils.forEach(this.sideKeys, side => {\n      total[side] = totals[timeSteps[nextStep]][side] * fraction + totals[timeSteps[nextStep - 1]][side] * (1 - fraction);\n  });\n    return total;\n  },\n\n  /**\n   * Updates entities\n   */\n  _updateEntities(reorder) {\n\n    const _this = this;\n    const time = this.model.time;\n    const sideDim = this.SIDEDIM;\n    const prefixedSideDim = this.PREFIXEDSIDEDIM;\n    const ageDim = this.AGEDIM;\n    const stackDim = this.STACKDIM;\n    const prefixedStackDim = this.PREFIXEDSTACKDIM;\n    const timeDim = this.TIMEDIM;\n    const duration = (time.playing) ? time.delayAnimations : 0;\n    let total;\n\n    const groupBy = this.groupBy;\n    //var group_offset = this.model.marker.group_offset ? Math.abs(this.model.marker.group_offset % groupBy) : 0;\n\n    if (this.ui.chart.inpercent) {\n      this.total = this.totals[time.value] ? this.totals[time.value] : this._interpolateBetweenTotals(this.timeSteps, this.totals, time.value);\n    }\n\n    const domain = this.yScale.domain();\n\n    //this.model.age.setVisible(markers);\n\n    //const nextStep = d3.bisectLeft(this.timeSteps, time.value);\n\n    const shiftedAgeDim = this.SHIFTEDAGEDIM;\n\n  //   const markers = this.markers.map(data => {\n  //       const o = {};\n  //   o[ageDim] = o[shiftedAgeDim] = +data[ageDim];\n  //   o[ageDim] -= nextStep * groupBy;\n  //   return o;\n  // });\n\n    const ageBars = this.markers.slice(0);\n\n    // const outAge = {};\n    // outAge[shiftedAgeDim] = markers.length * groupBy;\n    // outAge[ageDim] = outAge[shiftedAgeDim] - nextStep * groupBy;\n\n   //this.ageShift = 0;//= nextStep * groupBy;\n\n    // if (nextStep) ageBars.push(outAge);\n\n    this.entityBars = this.bars.selectAll(\".vzb-bc-bar\")\n        .data(ageBars, d => d[ageDim]);\n    //exit selection\n    this.entityBars.exit().remove();\n\n    const oneBarHeight = this.oneBarHeight;\n    const barHeight = this.barHeight;\n    const firstBarOffsetY = this.firstBarOffsetY;\n\n    //enter selection -- init bars\n    this.entityBars = this.entityBars.enter().append(\"g\")\n        .attr(\"class\", d => \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim])\n//  .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - groupBy) * oneBarHeight) + \")\")\n  .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\")\n  .merge(this.entityBars);\n\n    // this.entityBars.attr(\"class\", function(d) {\n    //     return \"vzb-bc-bar \" + \"vzb-bc-bar-\" + d[ageDim];\n    //   })\n\n\n    this.sideBars = this.entityBars.selectAll(\".vzb-bc-side\").data(d => _this.sideKeys.map(m => {\n        const r = {};\n    r[ageDim] = d[ageDim];\n    r[shiftedAgeDim] = d[shiftedAgeDim];\n    r[prefixedSideDim] = m;\n    r[sideDim] = m;\n    return r;\n  }), d => d[prefixedSideDim]);\n\n    this.sideBars.exit().remove();\n    this.sideBars = this.sideBars.enter().append(\"g\")\n        .attr(\"class\", (d, i) => \"vzb-bc-side \" + \"vzb-bc-side-\" + (!i != !_this.twoSided ? \"right\" : \"left\"))\n    .merge(this.sideBars);\n\n    if (reorder) {\n      this.sideBars.attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n    }\n\n    const _attributeUpdaters = this._attributeUpdaters;\n\n    this.stackBars = this.sideBars.selectAll(\".vzb-bc-stack\").data((d, i) => {\n      const stacks = _this.stacked ? _this.stackKeys : [_this.totalFieldName];\n      return stacks.map(m => {\n        const r = {};\n        r[ageDim] = d[ageDim];\n        r[shiftedAgeDim] = d[shiftedAgeDim];\n        r[sideDim] = d[sideDim];\n        r[stackDim] = m;\n        r[prefixedSideDim] = d[prefixedSideDim];\n        r[prefixedStackDim] = m;\n        return r;\n      });\n    }, d => d[prefixedStackDim]);\n\n    this.stackBars.exit().remove();\n    this.stackBars = this.stackBars.enter().append(\"rect\")\n      .attr(\"class\", (d, i) => \"vzb-bc-stack \" + \"vzb-bc-stack-\" + i + (_this.highlighted ? \" vzb-dimmed\" : \"\"))\n      .attr(\"y\", 0)\n      .attr(\"height\", barHeight)\n      .attr(\"fill\", d => _this.cScale(_this.colorUseNotProperty ? _this.frame.color[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : d[prefixedStackDim]))\n      .attr(\"width\", _attributeUpdaters._newWidth)\n      .attr(\"x\", _attributeUpdaters._newX)\n      .on(\"mouseover\", _this.interaction.mouseover)\n      .on(\"mouseout\", _this.interaction.mouseout)\n      .on(\"click\", _this.interaction.click)\n      .onTap(_this.interaction.tap)\n      .merge(this.stackBars);\n\n\n    if (reorder) this.stackBars\n      .attr(\"fill\", d => _this.cScale(_this.colorUseNotProperty ? _this.frame.color[d[_this.PREFIXEDSIDEDIM]][d[_this.AGEDIM]] : d[prefixedStackDim]))\n      .order();\n\n    const stepShift = (ageBars[0][shiftedAgeDim] - ageBars[0][ageDim]) - this.shiftScale(time.value) * groupBy;\n\n    if (duration) {\n      const transition = d3.transition()\n        .duration(duration)\n        .ease(d3.easeLinear);\n\n      this.entityBars\n        //.transition(transition)\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\");\n//        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      this.stackBars\n        .transition(transition)\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    } else {\n      this.entityBars.interrupt()\n        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - _this.yScale(d[shiftedAgeDim])) + \")\");\n//        .attr(\"transform\", (d, i) => \"translate(0,\" + (firstBarOffsetY - (d[shiftedAgeDim] - domain[0] - stepShift) * oneBarHeight) + \")\");\n      this.stackBars.interrupt()\n        .attr(\"width\", _attributeUpdaters._newWidth)\n        .attr(\"x\", _attributeUpdaters._newX);\n    }\n\n    // this.entityLabels = this.labels.selectAll(\".vzb-bc-label\")\n    //   .data(this.markers, d => d[ageDim]);\n    // //exit selection\n    // this.entityLabels.exit().remove();\n\n    // const entityLabels = this.entityLabels.enter().append(\"g\")\n    //   .attr(\"class\", \"vzb-bc-label\")\n    //   .attr(\"id\", d => \"vzb-bc-label-\" + d[shiftedAgeDim] + \"-\" + _this._id)\n    // entityLabels.append(\"text\")\n    //   .attr(\"class\", \"vzb-bc-age\")\n    //   .attr(\"y\", (d, i) => firstBarOffsetY - _this.yScale(d[shiftedAgeDim]) - 10);\n\n    // this.entityLabels = entityLabels.merge(this.entityLabels);\n    // // .style(\"fill\", function(d) {\n    // //   var color = _this.cScale(values.color[d[ageDim]]);\n    // //   return d3.rgb(color).darker(2);\n    // // });\n\n    // if (reorder) this.entityLabels.selectAll(\".vzb-bc-age\").attr(\"y\", (d, i) => firstBarOffsetY - _this.yScale(d[shiftedAgeDim]) - 10);\n\n    if (duration) {\n      this.year.transition().duration(duration).ease(d3.easeLinear)\n        .on(\"end\", this._setYear(time.value));\n    } else {\n      this.year.interrupt().text(time.formatDate(time.value)).transition();\n    }\n  },\n\n  _setYear(timeValue) {\n    const formattedTime = this.model.time.formatDate(timeValue);\n    return function() { d3.select(this).text(formattedTime); };\n  },\n\n  _interaction() {\n    const _this = this;\n    return {\n      mouseover(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.highlightMarker(d);\n        //_this._showLabel(d);\n      },\n      mouseout(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.clearHighlighted();\n      },\n      click(d, i) {\n        if (utils.isTouchDevice()) return;\n        _this.model.marker.selectMarker(d);\n      },\n      tap(d) {\n        d3.event.stopPropagation();\n        _this.model.marker.selectMarker(d);\n      }\n    };\n  },\n\n  _highlightBars(d) {\n    const _this = this;\n\n    _this.someHighlighted = (_this.model.marker.highlight.length > 0);\n\n    _this.updateBarsOpacity();\n\n    if (!_this.someHighlighted) {\n      //hide labels\n      _this.labels.selectAll(\".vzb-hovered\").classed(\"vzb-hovered\", false);\n    } else {\n      _this._showLabel(_this.model.marker.highlight[0]);\n    }\n  },\n\n  _showLabel(d) {\n    const _this = this;\n    const formatter = _this.ui.chart.inpercent ? d3.format(\".1%\") : _this.model.marker.axis_x.getTickFormatter();\n    const sideDim = _this.SIDEDIM;\n    const ageDim = _this.AGEDIM;\n    const stackDim = _this.STACKDIM;\n    const KEYS = this.KEYS;\n\n    const left = _this.sideKeys.indexOf(d[sideDim]);\n    const label = _this.labels.select(\".vzb-bc-label\");\n    const bar = _this.bars.select(\".vzb-bc-bar-\" + d[ageDim]);\n    //const label = _this.labels.select(\"#vzb-bc-label-\" + d[ageDim] + \"-\" + _this._id);\n    label.attr(\"transform\", bar.attr(\"transform\"))\n      .select(\".vzb-bc-age\")\n      .text(textData => {\n        //var total = _this.ui.chart.inpercent ? _this.totalValues[d[sideDim]] : 1;\n        let text = _this.stackKeys.length > 1 ? _this.stackItems[d[stackDim]] : _this.frame.label_age[d[ageDim]];\n        text = _this.twoSided ? text : text + \" \" + _this.stackItems[d[stackDim]];\n        const value = utils.getValueMD(d, _this.frameAxisX, KEYS);//_this.xScale.invert(d[\"width_\"]);\n        //var value = (_this.dataWithTotal || _this.stacked) ? _this.values1.axis_x[d[shiftedAgeDim]][d[sideDim]][d[stackDim]] / total : _this.xScale.invert(d[\"width_\"]);\n        return text + \": \" + formatter(value);\n      })\n      .attr(\"x\", (left ? -1 : 1) * (_this.activeProfile.centerWidth * 0.5 + 7))\n      .classed(\"vzb-text-left\", left);\n\n    label.classed(\"vzb-hovered\", true);\n  },\n\n  /**\n   * Executes everytime the container or vizabi is resized\n   * Ideally,it contains only operations related to size\n   */\n\n\n  presentationProfileChanges: {\n    medium: {\n      margin: { right: 80, bottom: 80 },\n      infoElHeight: 32\n    },\n    large: {\n      margin: { top: 100, right: 100, left: 100, bottom: 80 },\n      infoElHeight: 32\n    }\n  },\n\n  profiles: {\n    \"small\": {\n      margin: {\n        top: 70,\n        right: 20,\n        left: 40,\n        bottom: 40\n      },\n      infoElHeight: 16,\n      centerWidth: 2,\n      titlesSpacing: 5\n    },\n    \"medium\": {\n      margin: {\n        top: 80,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 20,\n      centerWidth: 2,\n      titlesSpacing: 10\n    },\n    \"large\": {\n      margin: {\n        top: 100,\n        right: 60,\n        left: 60,\n        bottom: 40\n      },\n      infoElHeight: 22,\n      centerWidth: 2,\n      titlesSpacing: 20\n    }\n  },\n\n  resize() {\n\n    const _this = this;\n\n    this.activeProfile = this.getActiveProfile(this.profiles, this.presentationProfileChanges);\n\n    //this.activeProfile = this.profiles[this.getLayoutProfile()];\n    const margin = this.activeProfile.margin;\n    const infoElHeight = this.activeProfile.infoElHeight;\n\n    //stage\n    this.height = (parseInt(this.element.style(\"height\"), 10) - margin.top - margin.bottom) || 0;\n    this.width = (parseInt(this.element.style(\"width\"), 10) - margin.left - margin.right) || 0;\n\n    if (this.height <= 0 || this.width <= 0) return utils.warn(\"Pop by age resize() abort: vizabi container is too little or has display:none\");\n\n    this.graph\n      .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    this.barsCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    this.labelsCrop\n      .attr(\"width\", this.width)\n      .attr(\"height\", Math.max(0, this.height));\n\n    const groupBy = this.groupBy;\n\n    const domain = this.yScale.domain();\n    this.oneBarHeight = this.model.marker.axis_y.scaleType == \"ordinal\" ? this.height / domain.length : this.height / (domain[1] - domain[0]);\n    const barHeight = this.barHeight = this.oneBarHeight * groupBy; // height per bar is total domain height divided by the number of possible markers in the domain\n    this.firstBarOffsetY = this.height - this.barHeight;\n\n    if (this.stackBars) this.stackBars.attr(\"height\", barHeight);\n\n    if (this.sideBars) this.sideBars\n      .attr(\"transform\", (d, i) => i ? (\"scale(-1,1) translate(\" + _this.activeProfile.centerWidth + \",0)\") : \"\");\n\n\n    //update scales to the new range\n    this.yScale.range([this.height, 0]);\n\n    const maxRange = this.twoSided ? ((this.width - this.activeProfile.centerWidth) * 0.5) : this.width;\n\n    this.xScale.range([0, maxRange]);\n\n    //apply scales to axes and redraw\n    this.yAxis.scale(this.yScale)\n      .tickValues([])\n      .tickSizeInner(-this.width)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.width, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_y.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 1\n      });\n\n    const format = this.ui.chart.inpercent ? d3.format((groupBy > 3 ? \"\" : \".1\") + \"%\") : this.model.marker.axis_x.getTickFormatter();\n\n    this.xAxis.scale(this.xScale)\n      .tickFormat(format)\n      .tickSizeInner(-this.height)\n      .tickSizeOuter(0)\n      .tickPadding(6)\n      .tickSizeMinor(-this.height, 0)\n      .labelerOptions({\n        scaleType: this.model.marker.axis_x.scaleType,\n        toolMargin: margin,\n        limitMaxTickNumber: 6\n      });\n\n    const translateX = this.twoSided ? ((this.width + _this.activeProfile.centerWidth) * 0.5) : 0;\n\n    this.xAxisEl.attr(\"transform\", \"translate(\" + translateX + \",\" + this.height + \")\")\n      .call(this.xAxis);\n\n    this.yAxisEl.attr(\"transform\", \"translate(\" + 0 + \",0)\")\n      .call(this.yAxis);\n    //this.xAxisEl.call(this.xAxis);\n    this.xAxisLeftEl.classed(\"vzb-hidden\", !this.twoSided);\n    if (this.twoSided) {\n      if (this.model.marker.axis_x.scaleType !== \"ordinal\") {\n        this.xScaleLeft.range([(this.width - this.activeProfile.centerWidth) * 0.5, 0]);\n      } else {\n        this.xScaleLeft.rangePoints([(this.width - this.activeProfile.centerWidth) * 0.5, 0]).range();\n      }\n\n      this.xAxisLeft.scale(this.xScaleLeft)\n        .tickFormat(format)\n        .tickSizeInner(-this.height)\n        .tickSizeOuter(0)\n        .tickPadding(6)\n        .tickSizeMinor(-this.height, 0)\n        .labelerOptions({\n          scaleType: this.model.marker.axis_x.scaleType,\n          toolMargin: margin,\n          limitMaxTickNumber: 6\n        });\n\n      this.xAxisLeftEl.attr(\"transform\", \"translate(0,\" + this.height + \")\")\n        .call(this.xAxisLeft);\n      const zeroTickEl = this.xAxisEl.select(\".tick text\");\n      if (!zeroTickEl.empty()) {\n        const zeroTickWidth = zeroTickEl.node().getBBox().width;\n        zeroTickEl.attr(\"dx\", -(this.activeProfile.centerWidth + zeroTickWidth) * 0.5);\n      }\n      this.xAxisEl.select(\".tick line\").classed(\"vzb-hidden\", true);\n   \n      //hide left axis zero tick\n      const tickNodes = this.xAxisLeftEl.selectAll(\".tick\").nodes();\n      d3.select(tickNodes[tickNodes.length - 1]).classed(\"vzb-hidden\", true);\n   }\n\n    const isRTL = this.model.locale.isRTL();\n\n    this.bars.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n    this.labels.attr(\"transform\", \"translate(\" + translateX + \",0)\");\n\n    this.title\n      .attr(\"x\", margin.left + (this.twoSided ? translateX - this.activeProfile.titlesSpacing : 0))\n      .style(\"text-anchor\", this.twoSided ? \"end\" : \"\")\n      .attr(\"y\", margin.top * 0.7);\n    this.titleRight\n      .attr(\"x\", margin.left + translateX + this.activeProfile.titlesSpacing)\n      .attr(\"y\", margin.top * 0.7);\n\n    this.xTitleEl\n      .style(\"font-size\", infoElHeight + \"px\")\n      .attr(\"transform\", \"translate(\" + (isRTL ? this.width : margin.left * 0.4) + \",\" + (margin.top * 0.4) + \")\");\n    this.xTitleEl.select(\"text\").text(this.model.marker.axis_x.getConceptprops().name);\n\n    if (this.xInfoEl.select(\"svg\").node()) {\n      const titleBBox = this.xTitleEl.node().getBBox();\n      const t = utils.transform(this.xTitleEl.node());\n      const hTranslate = isRTL ? (titleBBox.x + t.translateX - infoElHeight * 1.4) : (titleBBox.x + t.translateX + titleBBox.width + infoElHeight * 0.4);\n\n      this.xInfoEl.select(\"svg\")\n        .attr(\"width\", infoElHeight + \"px\")\n        .attr(\"height\", infoElHeight + \"px\");\n      this.xInfoEl.attr(\"transform\", \"translate(\"\n        + hTranslate + \",\"\n        + (t.translateY - infoElHeight * 0.8) + \")\");\n    }\n\n\n    this.year.attr(\"x\", this.width + margin.left).attr(\"y\", margin.top * 0.4);\n\n  },\n\n  updateBarsOpacity(duration) {\n    const _this = this;\n    //if(!duration)duration = 0;\n\n    const OPACITY_HIGHLT = 1.0;\n    const OPACITY_HIGHLT_DIM = this.model.marker.opacityHighlightDim;\n    const OPACITY_SELECT = this.model.marker.opacityRegular;\n    const OPACITY_REGULAR = this.model.marker.opacityRegular;\n    const OPACITY_SELECT_DIM = this.model.marker.opacitySelectDim;\n\n    this.stackBars\n    //.transition().duration(duration)\n      .style(\"opacity\", d => {\n\n        if (_this.someHighlighted) {\n          //highlight or non-highlight\n          if (_this.model.marker.isHighlighted(d)) return OPACITY_HIGHLT;\n        }\n\n        if (_this.someSelected) {\n          //selected or non-selected\n          return _this.model.marker.isSelected(d) ? OPACITY_SELECT : OPACITY_SELECT_DIM;\n        }\n\n        if (_this.someHighlighted) return OPACITY_HIGHLT_DIM;\n\n        return OPACITY_REGULAR;\n      });\n\n    this.stackBars.style(\"stroke\", d => _this.model.marker.isSelected(d) ? \"#333\" : null);\n\n    const nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n\n    // when pointer events need update...\n    if (nonSelectedOpacityZero != this.nonSelectedOpacityZero) {\n      this.stackBars.style(\"pointer-events\", d => (!_this.someSelected || !nonSelectedOpacityZero || _this.model.marker.isSelected(d)) ?\n        \"visible\" : \"none\");\n    }\n\n    this.nonSelectedOpacityZero = _this.model.marker.opacitySelectDim < 0.01;\n  }\n\n});\n\nexport default BarChartDS;\n\n\n\n// WEBPACK FOOTER //\n// ./src/component.js","module.exports = \"<!-- BarChartDS Component -->\\n<svg class=\\\"vzb-barchartds\\\">\\n    <g class=\\\"vzb-bc-header\\\">\\n        <g class=\\\"vzb-bc-axis-x-title\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x-info vzb-noexport\\\"></g>\\n        <text class=\\\"vzb-bc-title\\\"></text>\\n        <text class=\\\"vzb-bc-title vzb-bc-title-right\\\"></text>\\n        <text class=\\\"vzb-bc-year\\\"></text>\\n    </g>\\n    <g class=\\\"vzb-bc-graph\\\">\\n\\n        <g class=\\\"vzb-bc-axis-y-title\\\"></g>\\n\\n        <g class=\\\"vzb-bc-axis-y\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-bars-crop\\\">\\n            <g class=\\\"vzb-bc-bars\\\"></g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-x\\\"></g>\\n        <g class=\\\"vzb-bc-axis-x vzb-bc-axis-x-left\\\"></g>\\n\\n        <svg class=\\\"vzb-bc-labels-crop\\\">\\n            <g class=\\\"vzb-bc-labels\\\">\\n                <g class=\\\"vzb-bc-label\\\"><text class=\\\"vzb-bc-age\\\"></text></g>\\n            </g>\\n        </svg>\\n\\n        <g class=\\\"vzb-bc-axis-labels\\\">\\n            <!-- <text class=\\\"vzb-x_label\\\">Lifespan</text>\\n                  <text class=\\\"vzb-y_label\\\">Lifespan</text> -->\\n        </g>\\n    </g>\\n</svg>\\n\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/template.html\n// module id = 3\n// module chunks = 0"],"sourceRoot":""}